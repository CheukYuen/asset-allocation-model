整体目标是：**从约 1200 只产品中，构建 5 个“质量可控、风格分散、体验一致”的候选桶，用于资产配置阶段的随机抽取。**

---

# 产品池筛选与分桶规则说明

## 一、整体设计目标（先把“为什么”说清楚）

本机制服务于**资产配置阶段的产品候选池构建**，而不是直接做“最优产品排名”。
核心目标分为四点：

1. **保证产品质量底线**：剔除明显弱势、风险收益比失衡的产品
2. **保证分布公平与多样性**：避免用户因为随机性拿到“明显更差的一桶”
3. **保留头部 Alpha 暴露**：每个桶都能接触到收益最亮眼的产品
4. **满足策略覆盖完整性**：16 种一级策略在整体池中都有代表

**输入规模**：约 1200 只产品
**输出结果**：5 个产品桶（Bucket 1–5）
**使用方式**：资产配置阶段，用户随机获取 1 个桶作为候选产品池

---

## 二、Stage A：强 Alpha 产品识别（亮点池）

### 🎯 目标

提前识别**“绝对收益表现最突出的产品”**，作为后续分桶的公共增强因子，而不是让它们只集中在某几个桶里。

### 📌 规则说明

* 在全量产品池（≈1200 只）中
* 按 **1Y 收益率（return_1y）** 指标排序
* 选取 **收益率 Top 10 的产品**

### 📦 产出

* `Top_Return_Set`（收益最亮眼产品集合）
* 该集合在 Stage B 的后续步骤中 **会被强制注入到每个桶中**

> 说明：
> Stage A 不做任何风控或多样性约束，目的**不是公平，而是识别“最强信号”**。

---

## 三、Stage B：结构化过滤 + 分桶 + 再增强

Stage B 是核心阶段，负责把“可用产品”组织成 **5 个质量接近、结构可控的桶**。

---

### B1. 分位数计算方式（按一级策略分组）

* 按 **16 个一级策略**分别分组
* 在每个策略组内，分别对以下指标计算**横截面分位数（Percentile）**：

  * 收益率（return_3y）
  * 波动率（volatility_3y）
  * 夏普比率（sharpe_ratio_3y）

对策略 $s$ 下产品 $i$ 的指标 $x$，其分位数定义为：

$$
P_{i,s}^{(x)} = \frac{\#\{\, j \in s \mid x_{j,s} \le x_{i,s} \,\}}{N_s}
$$

其中：

* $P_{i,s}^{(x)} \in [0,1]$：表示该产品在**策略 $s$** 内该指标的相对位置
* $N_s$：策略 $s$ 下产品数量
* 分位数越接近 1，表示该指标在策略内越高（或越差，取决于指标含义）

> 约定说明：
>
> * 对 **收益率 / 夏普比率**：分位数越高 → 表现越好
> * 对 **波动率**：分位数越高 → 波动越大、风险越高（表现越差）

---

### B2. 剔除规则（联合逻辑 · 分位数版本）

在每个一级策略内部，若产品满足以下**联合剔除逻辑中的任一条件**，则被过滤出候选池：

1. **收益率分位数处于该策略内最差 10%**

   $$
   P_{i,s}^{(\text{return\_3y})} \leq 0.10
   $$

2. **或 夏普比率分位数处于该策略内最差 10%**

   $$
   P_{i,s}^{(\text{sharpe\_ratio\_3y})} \leq 0.10
   $$

3. **或（波动率分位数处于最差/最高 10%，且收益率低于策略中位数）**

   $$
   P_{i,s}^{(\text{volatility\_3y})} \geq 0.90 \quad \text{且} \quad P_{i,s}^{(\text{return\_3y})} < 0.50
   $$

---

### 说明

* 所有判断均基于**一级策略内部的相对位置（分位数）**，不使用绝对数值或跨策略比较
* 该联合逻辑实现了：

  * 对“**高波动但高收益**”产品的容忍（不误伤进攻型产品）
  * 对“**高波动且收益偏弱**”产品的有效剔除
  * 对“**低风险但收益一般**”产品的保留（防守型底仓）
* 分位数版本天然鲁棒，对极端值不敏感，适合用于稳定的规则化筛选

---

### 📦 产出

* `Filtered_Pool`：通过策略内质量过滤闸门的产品集合

---

## Stage C：分桶、桶内优选与再注入

---

### C1. 收益排序的均匀分桶（5 桶）

#### 规则

1. 对 `Filtered_Pool` 按 **1Y 收益率（return_1y）从高到低排序**
2. 顺序编号：1, 2, 3, …, N
3. 采用轮询方式分为 5 个桶：

* Bucket 1：1, 6, 11, 16, …
* Bucket 2：2, 7, 12, 17, …
* Bucket 3：3, 8, 13, 18, …
* Bucket 4：4, 9, 14, 19, …
* Bucket 5：5, 10, 15, 20, …

---

### C2. 桶内多维优选（分位数 + OR）

在每个桶内，保留满足以下任一条件（OR）的产品：

* **收益率处于桶内 Top 20% 分位（return_3y）**
* **夏普比率处于桶内 Top 20% 分位（sharpe_ratio_3y）**
* **波动率处于桶内最优 Top 20% 分位（低波动，volatility_3y）**

---

### C3. 一级策略覆盖约束

* 在整体保留集合中：

  * **16 种一级策略均至少保留 1 个产品**
* 若某一级策略缺失：

  * 从该策略中按 **return_3y 排序的名次 rank（从 1 开始）** 产品补充进入对应桶

---

### C4. 强 Alpha 再注入（去重）

* 将 `Top_Return_Set` 中的产品加入 **每一个桶**
* 若产品已存在于桶中，则跳过，不重复添加

---

#### 📦 最终结果

* 每个桶同时具备：

  * 均衡的收益结构
  * 多维风格代表
  * 明确的头部 Alpha 暴露

---

## 四、最终效果总结（一句话版本）

> 从 1200 只产品中，通过 **质量闸门 → 收益同构分桶 → 多维优选 → 强 Alpha 注入**，
> 构建 5 个 **统计性质一致、体验公平、风格多样、但都不失进攻性的产品桶**，
> 支撑资产配置阶段的随机抽桶机制，而不牺牲专业性与稳定性。

---

如果你愿意，下一步我可以帮你做三件事之一：
1️⃣ 把这套规则 **压缩成一段 LLM 可直接执行的 Prompt**
2️⃣ 输出 **工程实现伪代码 / Pipeline 结构**
3️⃣ 帮你评估：**这套规则是否会“过度中庸”或“削弱 Satellite Alpha”**
