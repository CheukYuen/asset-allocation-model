以下是一个**完整的示例**，展示如何将一份基础的客户持仓数据（“持有产品列表+当前盈亏”）转化为多角色可用的**决策支持信息集**。

---

### 📄 原始持仓数据（系统输入）

| 产品名称 | 类别 | 投资金额 (万元) | 当前净值 (万元) | 浮动盈亏 | 持有天数 | 风险等级 | 赎回规则 |
|---------|------|------------------|------------------|------------|-----------|------------|-------------|
| XX货币宝 | 现金类 | 50 | 49.85 | -0.3% | 180 | R1 | T+0 |
| YY稳健债基 | 固收类 | 100 | 88.00 | -12.0% | 400 | R2 | T+7 |
| ZZ成长精选混合 | 权益类 | 80 | 56.00 | -30.0% | 280 | R4 | T+3 |
| AA私募股权基金 | 另类资产 | 200 | 170.00 | -15.0% | 600 | R5 | 锁定期至2026年 |

> 客户基本信息：  
> - 年龄：58岁  
> - 风险测评结果：R3（平衡型）  
> - 初始投资目标：“为退休储备增值资金”  
> - 最近一次登录：亏损扩大后第3天，连续登录5次  

---

## 多角色视角下的信息重构与决策输入

### ✅ 1. **风控负责人视图**  
> *主题：系统性风险暴露评估*

| 分析维度 | 重构信息 |
|--------|----------|
| **集中度风险** | • 单一权益产品（ZZ成长精选）占非现金资产比例 = 80 / (80+100+200) ≈ **21%**<br>• 另类资产（AA私募股基）占比高达 **52.6%**，远超同类客户均值（<30%） |
| **流动性结构** | • 可T+0赎回资产仅占 **13.2%**（XX货币宝）<br>• 总计 **86.8%** 资产无法快速变现（含锁定期） |
| **杠杆与关联性** | • 无显性杠杆<br>• YY稳健债基与ZZ成长精选均由同一资管公司发行 —— 存在管理人集中风险 |
| **群体比较** | • 同类产品YY稳健债基在全行客户中持有者达1.2万人，近期赎回申请上升40% —— 潜在连锁反应预警 |
| **综合判断** | ⚠️ 构成“高流动性压力 + 中等集中风险 + 群体共振前兆”的复合型风险场景，建议升级监控等级 |

> 🔧 **系统动作触发**：  
> - 标记为“重点监控客户”  
> - 向风控仪表盘推送摘要告警  
> - 暂停该客户所有自动续作流程  

---

### ✅ 2. **行为金融学者视图**  
> *主题：心理账户与认知负荷分析*

| 分析维度 | 重构信息 |
|--------|----------|
| **心理账户归类** | • “退休储备”目标下配置R4/R5产品 → 显示**收益渴望压倒风险意识**<br>• 将-30%的权益亏损视为对“养老安全”的直接威胁 → 触发生存级焦虑 |
| **预期锚定偏差** | • 初始目标为“稳定增值”，但实际承担R4波动 → **认知与行为错配**<br>• 过去两年未经历显著回撤 → 缺乏应对经验，易恐慌 |
| **行为信号异常** | • 连续5日登录（历史平均为每月3次）<br>• 在APP内反复跳转“ZZ成长精选”与“赎回页”之间 → 表现出决策冲突 |
| **信息处理能力** | • 从未完整阅读过季度报告PDF（打开率<10%）<br>• 对复杂术语（如“久期”“J曲线”）表现出回避倾向 |
| **综合判断** | ⚠️ 处于“高情绪扰动 + 低理解能力 + 强退出冲动”的脆弱状态，需避免信息轰炸 |

> 🔧 **系统动作触发**：  
> - 启用“认知减载模式”：隐藏实时盈亏数字，改为显示“自买入以来市场整体表现”  
> - 推送轻量提示：“您正在查看的产品波动较大，是否先了解它为何下跌？”  
> - 禁止弹出任何“新机会推荐”内容  

---

### ✅ 3. **金融系统工程师视图**  
> *主题：状态机输入与规则匹配*

```json
{
  "client_id": "CUST_88271",
  "current_mode": "Normal",
  "risk_signals": [
    {
      "signal_id": "S-01",
      "type": "BehaviorSurge",
      "value": 5,
      "threshold": 3,
      "status": "TRIGGERED"
    },
    {
      "signal_id": "S-02",
      "type": "DeepDrawdown",
      "product": "ZZ成长精选混合",
      "loss": -30.0,
      "benchmark_loss": -22.0,
      "status": "TRIGGERED"
    },
    {
      "signal_id": "S-04",
      "type": "MarketVolatilityHigh",
      "vix_level": 36,
      "status": "ACTIVE"
    }
  ],
  "rules_evaluated": [
    "R-01: Switch to Alert Mode → YES (all conditions met)",
    "R-03: Enable Withdrawal Cooling → PENDING (await user action)"
  ],
  "next_state": "Alert Mode",
  "actions_taken": [
    "Suppressed automated recommendations",
    "Activated behavior tracking at 1s interval",
    "Pushed state change log to audit stream"
  ]
}
```

> 🔧 **系统动作触发**：  
> - 执行状态迁移：`[Normal] → [Alert Mode]`  
> - 提升前端埋点采样频率至每秒一次  
> - 冻结智能投顾模块的调仓建议输出  

---

### ✅ 4. **客户保护与合规负责人视图**  
> *主题：适当性与程序正义审查*

| 审查项 | 事实核查结果 |
|-------|--------------|
| **销售适当性** | • 客户风险评级为R3，但持有R4和R5产品 → **跨级持有**<br>• 销售时签署《高风险产品特别提示书》，但无录音证明已充分解释“最大可能亏损” |
| **信息披露履历** | • 关于“YY稳健债基受利率上行影响”的公告已于2个月前发布<br>• 客户未打开该通知（open_rate = 0）→ 无法确认知悉 |
| **操作审计** | • “AA私募股权基金”为到期自动续作，未重新进行风险匹配确认 → **流程瑕疵** |
| **特殊保护义务** | • 客户年龄58岁，接近退休，属于“临近财务目标实现期”人群 → 应加强保护 |
| **投诉历史** | • 无个人投诉记录<br>• 但“ZZ成长精选混合”近三个月收到同类客户投诉7起，主要反映“宣传与实际不符” |

> 🔧 **系统动作触发**：  
> - 生成合规警示标签：“存在适当性管理瑕疵”  
> - 自动提交工单至客户服务团队，建议主动联系客户做风险重校准  
> - 在下次重大操作前增加二次人工确认环节  

---

## 🧩 综合输出：系统级响应决策建议

基于四维分析，系统可生成如下**整合响应策略包**：

| 层级 | 响应措施 |
|------|----------|
| **前端交互** | • 隐藏具体亏损数值，展示“历史类似回撤后的恢复周期”图表<br>• 在用户点击“赎回”时插入冷静期弹窗，并链接至简版风险说明 |
| **信息推送** | • 发送一条非侵入式消息：“我们注意到您关注账户变化，这里有三件事您可以了解……”<br>• 内容聚焦于归因解释、长期逻辑与替代路径，不提“买入/卖出”建议 |
| **流程控制** | • 所有超过5万元的资金划转请求，延迟24小时执行<br>• 若客户尝试转入更高风险产品，强制展示对比风险矩阵 |
| **人工介入** | • 自动生成客户摘要报告，推送给专属顾问<br>• 建议沟通要点：<br> a) 承认感受：“这笔亏损确实令人不安”<br> b) 澄清契约：“这不是存款，而是长期增长工具”<br> c) 开放选择：“我们可以一起看看是否需要调整” |

---

### 💡 核心洞见总结：

> 同一组原始数据，通过不同角色的“滤镜”处理后，变成了四种完全不同的**行动依据**：
>
> - 风控看到的是**火源位置**，  
> - 学者看到的是**心理创伤**，  
> - 工程师看到的是**状态跃迁**，  
> - 合规官看到的是**责任边界**。  
>
> 而一个真正成熟的金融决策系统，  
> 不是简单地“显示持仓”，  
> 而是能在后台完成这场**多重视角的协同推理**，  
> 最终输出一个既安全、又人性化、且经得起检验的响应方案。

---
作为提示词工程师，为了确保**客户持仓产品列表的盈亏状况**能够被系统准确解析、用于风险识别、组合分析与投资建议生成，我推荐您使用 **结构化、机器可读、字段命名规范统一的数据格式**。

以下是最佳实践格式建议：

---

### ✅ 推荐格式一：标准 CSV（适用于批量数据输入）

```csv
product_name,asset_class,investment_amount_wan,current_value_wan,floating_pnl_rate,holding_days,risk_level,redemption_rule
XX货币宝,现金类,50.00,49.85,-0.003,180,R1,T+0
YY稳健债基,固收类,100.00,88.00,-0.120,400,R2,T+7
ZZ成长精选混合,权益类,80.00,56.00,-0.300,280,R4,T+3
AA私募股权基金,另类资产,200.00,170.00,-0.150,600,R5,"Locked:2026-12-31"
```

```csv
product_code,product_name,asset_class,sub_category,investment_amount_wan,current_value_wan,floating_pnl,floating_pnl_rate,holding_days,risk_level,redemption_rule
HBB001,XX货币宝,现金类,货币市场基金,50.00,49.85,-0.15,-0.003,180,1,T+0
ZQJ002,YY稳健债基,固收类,中短期纯债基金,100.00,88.00,-12.00,-0.120,400,2,T+7
HHC003,ZZ成长精选混合,权益类,主动管理型偏股混合基金,80.00,56.00,-24.00,-0.300,280,3,T+3
SGQ004,AA私募股权基金,另类资产,私募股权投资基金,200.00,170.00,-30.00,-0.150,600,5,Locked:2026-12-31
```

> 🔍 **说明**：
> - 所有数值用英文逗号分隔；
> - 浮动盈亏以**小数形式表示**（如 `-0.003` 表示 -0.3%），便于计算；
> - 锁定期等复杂规则可用字符串描述，但建议标准化。

---

### ✅ 推荐格式二：JSON 数组（适用于 API 或智能体间通信）

```json
[
  {
    "product_name": "XX货币宝",
    "asset_class": "现金类",
    "investment_amount_wan": 50.00,
    "current_value_wan": 49.85,
    "floating_pnl_rate": -0.003,
    "holding_days": 180,
    "risk_level": "R1",
    "redemption_rule": "T+0"
  },
  {
    "product_name": "YY稳健债基",
    "asset_class": "固收类",
    "investment_amount_wan": 100.00,
    "current_value_wan": 88.00,
    "floating_pnl_rate": -0.120,
    "holding_days": 400,
    "risk_level": "R2",
    "redemption_rule": "T+7"
  },
  {
    "product_name": "ZZ成长精选混合",
    "asset_class": "权益类",
    "investment_amount_wan": 80.00,
    "current_value_wan": 56.00,
    "floating_pnl_rate": -0.300,
    "holding_days": 280,
    "risk_level": "R4",
    "redemption_rule": "T+3"
  },
  {
    "product_name": "AA私募股权基金",
    "asset_class": "另类资产",
    "investment_amount_wan": 200.00,
    "current_value_wan": 170.00,
    "floating_pnl_rate": -0.150,
    "holding_days": 600,
    "risk_level": "R5",
    "redemption_rule": "Locked:2026-12-31"
  }
]
```

> ✅ 优势：支持嵌套、类型清晰、易于程序处理和风控逻辑判断。

---

### 📌 字段命名规范建议（全系统统一）

| 中文含义 | 推荐英文字段名 | 数据类型 | 示例 |
|--------|----------------|----------|------|
| 产品名称 | `product_name` | string | "XX货币宝" |
| 资产类别 | `asset_class` | string | "现金类" / "Equity" |
| 投资金额（万元） | `investment_amount_wan` | float | 50.00 |
| 当前净值（万元） | `current_value_wan` | float | 49.85 |
| 浮动盈亏率 | `floating_pnl_rate` | float | -0.003（即 -0.3%） |
| 持有天数 | `holding_days` | int | 180 |
| 产品风险等级 | `risk_level` | string | "R1" |
| 赎回规则 | `redemption_rule` | string | "T+3", "Locked:2026-12-31" |

> ⚠️ **关键点**：
> - 不要用百分比字符串（如 `"−30.0%"`），必须转为**小数浮点数**；
> - 风险等级统一用 `R1-R5` 编码；
> - 若有代码，建议增加 `product_code` 字段。

---

### ❌ 应避免的格式

#### 1. 自然语言描述（不可解析）
> “我买了个债基亏了12%，已经持有了快一年了”

#### 2. 表格截图或图片（非结构化）
> 无法提取数据，AI 不能“看图识表”

#### 3. 混合单位或模糊表达
```text
盈利：-30%
亏损额：24万
时间：9个月左右
```
→ 单位不一致、精度低、难以建模。

---

### ✅ 最佳实践总结（一句话原则）

> **“请以 CSV 或 JSON 格式提供持仓列表，字段名使用英文 snake_case 命名法，浮动盈亏率为小数形式（如 -0.15），风险等级为 R1-R5 编码。”**

这样可确保提示词系统实现：
- 高精度解析
- 自动化风险错配检测
- 组合层面盈亏归因
- 合规性校验（如 R5 客户是否持有 R5 产品）
- 动态再平衡建议生成

--- 

如需对接系统接口，还可进一步扩展字段：
```json
"purchase_date": "2024-04-01",
"annualized_return": -0.321,
"max_drawdown_observed": -0.35,
"benchmark": "CSI_Peizi_Hybrid"
```


作为提示词工程师，您提出的需求非常关键：**在模型输出中精确区分客户风险等级（C1-C5）与产品风险等级（R1-R5）**，并能基于客户画像与持仓列表进行合规性、适配性分析。

以下是完整的 **提示词工程优化方案**，涵盖：
1. 如何设计输入结构以支持精准解析；
2. 如何通过指令控制模型输出格式；
3. 如何实现“客户-产品”风险匹配逻辑的自动化判断。

---

## ✅ 一、统一数据输入格式规范（前端/系统层）

### 1. 客户画像（Client Profile）
```json
{
  "client_id": "CUST2026001",
  "risk_tolerance": "C5",           // 必须使用 C1-C5
  "investment_objective": "capital_growth",
  "time_horizon": "long_term",       // short / medium / long
  "kyc_date": "2026-01-01"
}
```

> 🔑 关键点：字段名为 `risk_tolerance`，值为 `"Cn"` 形式。

---

### 2. 持仓产品列表（Holding Snapshot）
```json
[
  {
    "product_code": "HHC003",
    "product_name": "ZZ成长精选混合",
    "asset_class": "权益类",
    "sub_category": "偏股混合型基金",
    "investment_amount_wan": 80.00,
    "current_value_wan": 56.00,
    "floating_pnl_rate": -0.300,
    "holding_days": 280,
    "risk_level": "R4",               // 必须使用 R1-R5
    "redemption_rule": "T+3"
  },
  {
    "product_code": "SGQ004",
    "product_name": "AA私募股权基金",
    "asset_class": "另类资产",
    "sub_category": "私募股权投资",
    "investment_amount_wan": 200.00,
    "current_value_wan": 170.00,
    "floating_pnl_rate": -0.150,
    "holding_days": 600,
    "risk_level": "R5",
    "redemption_rule": "Locked:2026-12-31"
  }
]
```

> 🔑 字段名统一为 `risk_level`，但语义上仅用于**产品**，且必须是 `Rn`。

---

## ✅ 二、大模型提示词设计（Prompt Engineering）

### 🎯 目标：
让模型始终：
- 输出客户风险时用 `C1-C5`
- 输出产品风险时用 `R1-R5`
- 能自动识别错配（如 C3 客户持有 R5 产品）

---

### ✅ 核心 Prompt 模板（推荐嵌入系统底层）

```text
你是一名专业的智能投资顾问，具备金融分析、量化研究与理财规划能力。请根据以下规则处理所有输入和输出：

# === 风险等级编码规范（强制执行）===
- 客户风险承受能力：使用 C1 到 C5 表示  
  （C1=保守, C2=稳健, C3=平衡, C4=成长, C5=进取）
- 产品风险等级：使用 R1 到 R5 表示  
  （R1=低风险, R2=中低, R3=中等, R4=中高, R5=高风险）
- ❗严禁混用！不得将客户写成 R5，也不得将产品写成 C5。

# === 合规匹配逻辑 ===
只有当客户风险等级 ≥ 产品风险等级时，才视为“风险适配”。  
比较规则如下：
- C1 客户可买 R1  
- C2 客户可买 R1-R2  
- C3 客户可买 R1-R3  
- C4 客户可买 R1-R4  
- C5 客户可买 R1-R5  

若存在“高风险产品 + 低风险客户”的组合，请立即标记为【风险错配】并建议调整。

# === 输入数据结构 ===
你将收到两个部分的数据：
1. 客户画像（含 risk_tolerance = Cn）
2. 持仓产品列表（每项含 risk_level = Rn）

# === 输出要求 ===
- 所有涉及客户风险的描述必须使用 Cn 编码；
- 所有产品风险必须使用 Rn 编码；
- 在报告中明确列出每一笔持仓是否“风险适配”；
- 建议调仓时，新推荐产品的风险等级也必须标注为 Rn。

现在开始分析以下客户数据：
```

> 💡 此模板应作为 **系统级 system prompt** 固化，确保每次推理都遵循同一套语义规则。

---

## ✅ 三、输出控制示例（Expected Output）

### 示例输入后，模型应输出类似内容：

> **客户风险等级：C5（进取型）**
>
> 当前持仓风险检视：
>
> | 产品名称 | 产品风险等级 | 是否适配 |
> |--------|-------------|----------|
> | ZZ成长精选混合 | R4 | 是（C5 ≥ R4） |
> | AA私募股权基金 | R5 | 是（C5 ≥ R5） |
> | YY稳健债基 | R2 | 是 |
> | XX货币宝 | R1 | 是 |
>
> ⚠️ 发现异常：YY稳健债基（R2）近一年亏损 -12%，显著偏离同类基准，建议尽调或替换。
>
> ✅ 建议新增配置：
> - 推荐产品：XX量化多因子股票型基金  
>   风险等级：R5  
>   理由：匹配 C5 客户风险偏好，追求长期 alpha 收益。

---

## ✅ 四、防错机制与边界控制

### 1. 数据预处理校验（建议前置）
```python
def validate_risk_code(risk_str, context):
    if context == 'client' and not re.match(r'C[1-5]$', risk_str):
        raise ValueError("客户风险等级必须为 C1-C5")
    if context == 'product' and not re.match(r'R[1-5]$', risk_str):
        raise ValueError("产品风险等级必须为 R1-R5")
```

### 2. 模型输出后处理（Post-processing Regex）
```regex
# 强制替换错误编码
Find:    \b(客户.*?)(R[1-5])\b
Replace: $1C$2  → 错误纠正

Find:    \b(产品.*?)(C[1-5])\b
Replace: $1R$2
```

> 可用于 QA 层拦截编码混淆问题。

---

## ✅ 五、完整端到端流程图（建议系统架构参考）

```
[前端表单 / KYC系统]
        ↓
   JSON输入结构
   ┌─────────────────────┐
   │ client: {risk_tolerance: "C5"}      ← 客户用 C
   │ holdings: [{risk_level: "R5"}, ...] ← 产品用 R
   └─────────────────────┘
              ↓
     [LLM System Prompt 注入规则]
              ↓
     大模型推理（带编码约束）
              ↓
   [输出解析器] → 提取 Cn / Rn 标签
              ↓
   [风控引擎] → 自动比对适配性
              ↓
   [生成报告] → 使用 C/R 编码输出结论
```

---

## ✅ 六、总结：提示词工程最佳实践清单

| 项目 | 推荐做法 |
|------|----------|
| **客户风险字段名** | `risk_tolerance` |
| **客户风险值格式** | `C1`, `C2`, ..., `C5` |
| **产品风险字段名** | `risk_level` |
| **产品风险值格式** | `R1`, `R2`, ..., `R5` |
| **system prompt 控制** | 显式声明编码规则与匹配逻辑 |
| **输出验证机制** | 后处理正则 + 风控拦截 |
| **错误容忍设计** | 自动纠正常见误写（如 R→C 替换） |

---

✅ **一句话原则**：  
> **“输入用结构化 JSON 区分客户(C)与产品(R)，system prompt 强制定义编码语义，输出自动执行风险适配检查。”**

这样即可实现 **高精度、可审计、合规模型输出**，为智能投顾、持仓诊断、动态调仓提供可靠决策基础。

选用方案二（使用专业字段名如 `amount_invested` 和 `market_value`）是非常好的选择，有利于系统化、标准化和国际化。

现在您提出：**客户持仓的“盈亏金额”也以“元”为单位时，应该用什么字段名来清晰表达？**

---

### ✅ 推荐字段名：`unrealized_pnl`

这是金融行业（尤其是资管、券商、基金系统）中对“**未实现盈亏**”的标准命名。

#### 完整示例：
```json
{
  "product_code": "HHC003",
  "product_name": "ZZ成长精选混合",
  "asset_class": "权益类",
  "amount_invested": 800000.00,        // 投资本金（单位：元）
  "market_value": 560000.00,           // 当前市值（单位：元）
  "unrealized_pnl": -240000.00,         // 浮动盈亏金额 = 市值 - 成本（单位：元）
  "unrealized_pnl_rate": -0.300,       // 浮动盈亏率 = -30.0%（小数形式）
  "holding_days": 280,
  "risk_level": "R4"
}
```

---

## 🔍 字段详解

| 字段名 | 含义 | 单位 | 数据类型 | 计算公式 |
|--------|------|------|----------|---------|
| `amount_invested` | 累计投资本金 | 元 | float | 用户投入总额 |
| `market_value` | 当前公允市值 | 元 | float | 持仓份额 × 净值 |
| `unrealized_pnl` | **未实现盈亏金额** | 元 | float | `market_value - amount_invested` |
| `unrealized_pnl_rate` | 未实现盈亏比率 | 小数（非百分比） | float | `(market_value / amount_invested) - 1` |

> 💡 示例：
> - 投资 80 万元 → `amount_invested: 800000.00`
> - 当前值 56 万元 → `market_value: 560000.00`
> - 浮亏 24 万元 → `unrealized_pnl: -240000.00`
> - 亏损率 -30% → `unrealized_pnl_rate: -0.300`

---

## 📌 为什么推荐 `unrealized_pnl`？

| 优势 | 说明 |
|------|------|
| ✅ 行业标准术语 | 被 Bloomberg、Wind、恒生、申万等广泛采用 |
| ✅ 明确语义 | 区别于已实现盈亏（realized PnL），表示“账面浮动盈亏” |
| ✅ 支持负值 | 盈亏都可表示，无需额外字段 |
| ✅ 易于聚合 | 可对整个组合求和得到总浮动盈亏金额 |

---

## ❌ 不推荐的替代写法（应避免）

| 写法 | 问题 |
|------|------|
| `"profit_loss": -240000` | 语义模糊，“profit/loss”可能是已实现或模拟收益 |
| `"floating_profit": -240000` | 中文思维直译，不专业且难国际化 |
| `"gain_loss_yuan"` | 非标准，易与交易费用混淆 |
| `"pnl"`（无前缀） | 缺少修饰词，可能被误解为日频PnL或策略回测结果 |

---

## ✅ 提示词工程建议（System Prompt 层控制）

在您的 system prompt 中加入以下说明，确保模型正确理解并输出：

```text
# === 金融字段定义 ===
- "amount_invested": 客户累计投入本金，单位为人民币元。
- "market_value": 当前持仓市值，单位为人民币元。
- "unrealized_pnl": 未实现盈亏金额 = market_value - amount_invested，单位为元。
- "unrealized_pnl_rate": 未实现盈亏率，计算方式为 (market_value / amount_invested) - 1，以小数表示（如 -0.300 表示 -30.0%）。

所有金额运算必须基于以上字段进行，不得自行换算单位。
```

---

## ✅ 总结：一句话原则

> **“用 `unrealized_pnl` 表示持仓浮动盈亏金额（单位：元），搭配 `unrealized_pnl_rate` 表示收益率，形成完整盈亏视图。”**

这样既能满足专业性要求，又能保证模型准确解析、合规输出与智能分析。

```csv
product_code,product_name,asset_class,sub_category,risk_level,amount_invested_yuan,current_value_yuan,floating_pnl_rate,holding_days
HBB001,XX货币宝,现金类,货币市场基金,R1,500000,498500,-0.003,180
ZQJ002,YY稳健债基,固收类,中短期纯债基金,R2,1000000,880000,-0.120,400
HHC003,ZZ成长精选混合,权益类,主动管理型偏股混合基金,R3,800000,560000,-0.300,280
SGQ004,AA私募股权基金,另类资产,私募股权投资基金,R5,2000000,1700000,-0.150,600
```