这是一个**非常专业、而且“决定系统能不能长期跑”的问题**。
我直接给你**结论 → 原理 → 不同场景的最优写法 → 生产级建议**，不绕。

---

## 一、结论先行（可直接执行）

> **Prompt Header 中：
> 👉 结构化“数据表”应继续使用 ```csv
> 👉 纯数值矩阵（协方差 / 相关）不要用 csv，也不要强制 Markdown 表格
> 👉 元信息 / 规则用普通文本（不要代码块）**

**你现在「优化后」的写法，方向是对的，只需要微调即可。**

---

## 二、为什么“不是所有东西都该用 ```csv”？

从**大模型解析机制**来看，Markdown 不是“装饰”，而是**强信号**。

### ```csv 在模型眼里意味着什么？

当模型看到：

```csv
a,b,c
1,2,3
```

它会**自动切换成：**

> “这是一个**结构化、可枚举、字段对齐的数据集**”

适合：

* 行级比较
* 列级统计
* 横向筛选
* 产品 / 策略 / 资产列表

---

### 那矩阵呢？（协方差 / 相关）

协方差矩阵 **不是表格，是线性代数对象**。

如果你用 ```csv：

```csv
0.0004,0.0000,-0.0005,-0.0006
...
```

模型**仍然能读**，但会产生两个副作用：

1. **容易被误当成“行样本”**
2. 更容易被模型“尝试重新计算 / 转置 / 正则化”

而你真正想表达的是：

> “这是一个**定序矩阵对象**，只能解释，不能动。”

---

## 三、生产级推荐规范（直接给你标准）

### ✅ 1️⃣ 元信息 / 规则 —— 不用代码块

```text
【资产顺序】债券｜现金｜商品｜股票
【数据频率】资产：月度（已年化）
```

**原因**：

* 这是“控制信息”
* 用代码块会降低其“约束力”

---

### ✅ 2️⃣ 纯矩阵（协方差 / 相关）—— 用普通代码块（不标语言）

```text
# 协方差矩阵（4x4，年化收益率平方）
0.000403,0.000004,-0.000575,-0.000676
0.000004,0.000010,-0.000024,0.000059
-0.000575,-0.000024,0.010262,0.002503
-0.000676,0.000059,0.002503,0.046798
```

**好处：**

* 模型会当成“数值对象”
* 不会触发表格推理
* 更适合做**结构解释、风险来源分析**

---

### ✅ 3️⃣ 标准数据表 —— 必须用 ```csv

适用对象：

* Benchmark
* 策略基准
* 利率时间序列
* 产品列表

```csv
asset_class,ann_return_1y,ann_vol_1y,sharpe_ratio_1y
CASH,0.0123,0.0004,-1.74
...
```

**这是你现在做得最对的一点**。

---

## 四、你这份 Prompt Header 的「最佳写法微调版」

### 🔧 推荐微调总结

| 内容类型        | 推荐写法   | 是否用 ```csv |
| ----------- | ------ | ---------- |
| 数据元信息       | 普通文本   | ❌          |
| 协方差矩阵       | 普通代码块  | ❌          |
| 相关矩阵        | 普通代码块  | ❌          |
| 波动率向量       | 普通代码块  | ❌          |
| 利率时间序列      | ```csv | ✅          |
| Benchmark 表 | ```csv | ✅          |
| 策略基准表       | ```csv | ✅          |

---

## 五、非常关键的一点（你已经走在前面了）

> **Markdown 是“给模型的提示词”，不是“给人看的排版”。**

你现在已经在做的是：

* 把 Prompt 当成 **API Contract**
* 而不是“文档”

这是**金融 + LLM 能规模化落地的必要前提**。

---

## 六、一句话总结（给你定心）

> 你的直觉是对的：
> **Prompt 里应该用 ```csv，但只在“模型需要按列理解的数据”上用。**
>
> 你现在这套数据结构，已经完全达到了
> **“可被多模型稳定复用的生产级 Prompt Header”标准。**

---

如果你愿意，下一步我可以直接帮你做一件**非常值钱的事**：

👉 **把这份 Prompt Header 拆成：**

* System Prompt（不变）
* Data Prompt（版本化）
* Task Prompt（最小可变）

这一步做完，你这套体系就**真的可以进系统跑了**。

===

下面我把你整套 Prompt **直接落成“三段式”生产结构**：
**System（固定） + Data Pack（版本化） + Task（可变）**。
你复制到工程里就能用：只替换 Data Pack，Task 永远很短，输出风格稳定。

---

# ① System Prompt（固定，不随数据变）

```text
你是一名面向中国市场的“投顾级资产配置与产品分析助手”，具备金融分析、量化研究、投资顾问与理财规划综合能力。

【目标】
在给定数据与约束下，输出可解释、可执行、符合投顾语气的分析与建议，覆盖：产品解读、产品推荐、资产配置、持仓分析、市场解读。

【严格规则】
1) 唯一事实来源：仅使用“DATA PACK”与用户后续提供的内容。不得调用外部信息，不得编造数据。
2) 禁止行为：
   - 补全缺失字段、虚构指标、推断未给出的数值
   - 重新计算协方差/相关矩阵/Sharpe、或对矩阵进行转置/平滑/缩放
   - 重排资产顺序或更改数据口径
3) 允许行为：
   - 对时间序列做“趋势/拐点/波动/区间”总结（只用原数据归纳）
   - 做结构对比、风险解释、情景推演（需明确假设）
4) 输出必须“结论可追溯”：每个关键判断需引用 DATA PACK 中的具体字段或清晰金融逻辑。

【分析流程（默认）】
A. 先读 DATA_META（频率/窗口/资产顺序/口径）
B. 任务分流（TASK_ADAPTER）
C. 先结构后结论：风险结构 → 基准对照 → 产品/组合落地 → 风险提示
D. 输出形式：结论要点（3-6条）→ 数据支撑（分点引用）→ 可执行建议（区间/清单）→ 风险提示

【输出风格】
- 投顾口吻：克制、专业、可解释；不做收益承诺，不下“买卖指令”
- 数值引用：只引用给定数据；缺失值要显式说明“缺失/不可得”
- 建议表达：优先给“权重区间/优先级/替代方案”，避免精确点值

【任务自适应（TASK_ADAPTER）】
- 产品解读：对比同 sub_category 的中位数画像（收益/波动/回撤/Sharpe）→ 给定位与风险点
- 产品推荐：先匹配风险等级与配置缺口→ 给1-3个候选+理由+适用人群+回撤预期（用历史指标表达）
- 资产配置：优先用协方差/相关/波动解释分散与风险预算→ 给大类权重区间与再平衡规则
- 持仓分析：评估集中度/风格偏移/风险来源→ 给调整方向与执行顺序
- 市场解读：先从宏观归纳特征→ 再用利率曲线（1Y/10Y/利差）解释资产相对吸引力（不做短期预测）
```

---

# ② Data Pack（版本化：只替换这一段）

> 命名建议：`DATA_PACK_CN_v20251211`（版本号按你的数据截止日）

````text
## [DATA_PACK_ID]
CN_ASSET_ALLOC_DATA_PACK_v20251211

## [DATA_META]
【数据频率】宏观:月度/不齐；资产数据:月度(已年化)；无风险利率:季度(名义值)；基准画像:日频超额；策略基准:日频超额
【时间窗口】宏观:截至2025-12；资产:2011-2025；无风险利率:2021-2025；基准画像/策略基准:2025-12-11
【资产顺序】债券、现金、商品、股票
【使用约定】矩阵仅用于解释与决策判断；不得重算/转置/平滑；不得重排资产顺序。

## [MACRO_PANEL_RAW]
说明：以下为原始宏观长表。使用时先聚合为四类特征：最近值、近12月趋势、拐点/反转、波动区间；再用于市场解读与配置倾向判断。
```csv
indicator_id,ref_month,publish_date,value,unit,adjustment,source,data_type
...（你的宏观csv全文）...
````

## [RISK_STRUCTURE_LONG_TERM]

### 协方差矩阵（4x4，年化收益率平方；资产顺序见 DATA_META）

```
0.000403,0.000004,-0.000575,-0.000676
0.000004,0.000010,-0.000024,0.000059
-0.000575,-0.000024,0.010262,0.002503
-0.000676,0.000059,0.002503,0.046798
```

### 年化波动率向量（4个数值；资产顺序见 DATA_META）

```
0.0201,0.0032,0.1013,0.2163
```

### 相关矩阵（4x4；无单位；资产顺序见 DATA_META）

注意：此处必须保持“唯一版本”，避免与其它相关矩阵冲突。

```
1.00,0.06,-0.28,-0.16
0.06,1.00,-0.07,0.09
-0.28,-0.07,1.00,0.11
-0.16,0.09,0.11,1.00
```

## [RISK_FREE_RATE_QUARTERLY]

```csv
date,quarter_label,1y_cny_gov_yield,10y_cny_gov_yield,term_spread
...（你的利率csv）...
```

## [BENCHMARK_4_ASSET]

```csv
asset_class,ann_return_1y,ann_return_3y,ann_return_5y,ann_vol_1y,ann_vol_3y,ann_vol_5y,sharpe_ratio_1y,sharpe_ratio_3y,sharpe_ratio_5y
...（你的benchmark csv）...
```

## [STRATEGY_BENCHMARK_MEDIAN]

```csv
sub_category,return_1y,return_3y,return_5y,volatility_1y,volatility_3y,volatility_5y,max_drawdown_1y,max_drawdown_2y,max_drawdown_3y,sharpe_ratio_1y,sharpe_ratio_3y,sharpe_ratio_5y
...（你的策略基准csv）...
```

## [INVESTABLE_UNIVERSE]

```csv
product_name,product_code,currency,asset_class,sub_category,risk_level,return_1y,return_3y,return_5y,volatility_1y,volatility_3y,volatility_5y,max_drawdown_1y,max_drawdown_2y,max_drawdown_3y,sharpe_ratio_1y,sharpe_ratio_3y,sharpe_ratio_5y
...（你的产品池csv）...
```

````

> 工程里你只需要更新这段 Data Pack（例如换成 `v20260131`），System 不动。

---

# ③ Task Prompt（可变：极短，按任务类型直接填）

下面给你 5 个“最小可用 Task 模板”，你每次只改少量字段即可。

---

## A) 产品解读（单产品）

```text
[TASK]
产品解读。

[INPUT]
product_code=530012
关注：定位（属于哪类策略/资产）、与同 sub_category 中位数对比、风险点（波动/回撤/Sharpe）、适合人群与持有方式。

[OUTPUT]
用要点输出：结论(<=6条) + 数据对照(引用字段) + 风险提示 + 持有建议（不下买卖指令）。
````

---

## B) 产品推荐（按风险等级 & 目的）

```text
[TASK]
产品推荐。

[INPUT]
risk_level=R3
目标：稳健增值 + 分散
币种：CNY
约束：最多推荐3只；必须来自 INVESTABLE_UNIVERSE；每只给出“为何适配 + 主要风险 + 与中位数对照”。

[OUTPUT]
给：推荐清单(1-3) + 每只产品的理由与风险 + 组合搭配建议（权重区间）。
```

---

## C) 资产配置（按风险档/目标）

```text
[TASK]
资产配置建议。

[INPUT]
风险偏好：中等（可接受阶段性回撤）
期限：3-5年
币种：CNY
要求：用相关/协方差/波动解释分散逻辑；给四大类权重区间与再平衡规则；结合利率曲线判断固收吸引力。

[OUTPUT]
结论要点 + 配置区间（四大类）+ 关键依据（引用矩阵/利率/benchmark字段）+ 风险提示。
```

---

## D) 持仓分析（输入持仓表）

````text
[TASK]
持仓分析与调整建议。

[INPUT]
持仓（csv）如下：
```csv
product_code,amount,market_value,profit_pct
...
````

要求：识别集中度与风险来源（按 asset_class/sub_category 聚合），与 BENCHMARK_4_ASSET/STRATEGY_BENCHMARK_MEDIAN 对照，给出调整优先级与替代品候选（来自 INVESTABLE_UNIVERSE）。

[OUTPUT]
问题诊断(结构/风险) + 调整动作清单（按优先级） + 替代候选（1-3）+ 风险提示。

````

---

## E) 市场解读（只用宏观与利率）

```text
[TASK]
市场解读（不做短期预测）。

[INPUT]
请基于 MACRO_PANEL_RAW 先提炼“最近值/趋势/拐点/波动”四类特征，再结合 RISK_FREE_RATE_QUARTERLY（1Y/10Y/利差）给出：
1) 当前宏观环境画像
2) 对四大类资产的相对吸引力提示（方向性）
3) 对资产配置的倾向建议（区间/偏好）

[OUTPUT]
三段：环境画像 → 资产含义 → 配置启示 + 风险提示。
````

---

# 工程落地建议（超短、但很关键）

* **System Prompt**：固定写死在服务端（或模型配置中）
* **Data Pack**：作为版本化文本（文件或 DB），按日期更新
* **Task Prompt**：前端/业务层按场景拼装（极短，低 token）

---

下面我**从“提示词工程 + 金融风控口径治理”的角度**，把你的问题拆成**可直接落地的工程方案**。不是讲道理，而是告诉你**怎么写，模型才不会犯错**。

---

# 一、核心目标再明确一次（这是工程问题，不是语义问题）

你要解决的不是“模型懂不懂 C1 / R1”，而是：

> **如何让模型在任何场景、任何任务下，都“不可能”把 C 和 R 用错。**

这是**输出控制（Output Control）**问题，而不是知识问题。

---

# 二、问题 1：如何控制模型输出

👉 客户风险等级 = **C1–C5**
👉 产品风险等级 = **R1–R5**

## ✅ 结论先行（工程级）

> **必须同时使用三层约束：**
>
> 1. 语义层（定义）
> 2. 结构层（字段名）
> 3. 输出校验层（强制格式）

**只用其中一层，都会出错。**

---

## ① 语义层：定义“不可混用规则”（System Prompt）

这是**最高优先级规则**，必须写进 System Prompt。

```text
【风险等级口径（强制）】
- 客户风险等级：仅使用 C1–C5 表示（C = Client）
- 产品风险等级：仅使用 R1–R5 表示（R = Risk）

【严格禁止】
- 使用 R 等级描述客户
- 使用 C 等级描述产品
- 省略前缀（如仅写“3级风险”）

【错误处理】
- 若输入数据存在口径混乱，需先指出并请求澄清，再继续分析
```

> ⚠️ 注意：
> **“严格禁止” + 明确错误处理**，能显著降低模型“自作聪明纠错”。

---

## ② 结构层：字段名设计（这是最关键的一层）

### ❌ 错误示例（模型最容易混）

```csv
risk_level,product_name
3,XX基金
```

模型会自动脑补“3 = R3 or C3”，**必错**。

---

### ✅ 正确示例（工程级）

#### 客户画像字段

```csv
client_id,client_risk_level_C,investment_horizon,goal
A001,C3,5Y,稳健增值
```

#### 产品字段

```csv
product_code,product_name,product_risk_level_R,asset_class
530012,中欧医疗健康C,R4,股票类
```

> **字段名即规则**：
> `client_risk_level_C` 和 `product_risk_level_R`
> 是对模型的**强结构暗示**，比文字说明还有效。

---

## ③ 输出层：强制输出格式（防“口语化漂移”）

在 Prompt 里**明确规定输出格式**：

```text
【输出格式要求】
- 客户风险等级：使用 Cx（如 C3）
- 产品风险等级：使用 Rx（如 R4）
- 不得出现“高/中/低风险”替代描述
```

如果你希望更极致（**生产环境推荐**）：

```text
【输出校验】
- 若输出中出现 “R” 用于客户，或 “C” 用于产品，视为错误输出
- 错误时请自检并重新输出
```

这一步能显著减少“最后一公里”错误。

---

# 三、问题 2：如果告诉模型【客户画像 + 持仓产品列表】，该怎么写 Prompt？

下面给你一个**“最小但完整、极稳”的工程模板**。

---

## ✅ 推荐 Prompt 模板（直接可用）

### 【客户画像】

```csv
client_id,client_risk_level_C,age,investment_horizon,goal
A001,C3,38,5Y,稳健增值
```

### 【客户当前持仓】

```csv
product_code,product_name,product_risk_level_R,asset_class,sub_category,market_value
530012,中欧医疗健康C,R4,股票类,行业主题型,300000
540006,长信量化先锋B,R3,股票类,量化多因子,200000
000011,易方达易理财C,R1,现金类,货币基金,150000
```

---

### 【任务指令】

```text
[TASK]
请进行持仓风险适配性分析。

【分析规则】
1) 以客户风险等级 C3 为唯一风险承受上限参考
2) 判断当前持仓中是否存在：
   - 超出客户风险等级的产品（R > C）
   - 风险集中或结构性失衡
3) 所有判断必须明确区分：
   - 客户风险等级（C）
   - 产品风险等级（R）

【输出要求】
- 明确标注：客户风险等级（C）
- 每个产品明确标注：产品风险等级（R）
- 给出是否匹配 / 偏高 / 偏低的判断
- 不得混用 C 与 R 的符号体系
```

---

## 🔍 为什么这个 Prompt 非常稳？

| 维度 | 为什么不容易出错       |
| -- | -------------- |
| 语义 | 明确 C=客户，R=产品   |
| 结构 | 字段名已区分         |
| 推理 | 用 R > C 这种显式规则 |
| 输出 | 强制格式           |

> 这是**银行 / 券商 / 智能投顾系统**常用的口径控制方式。

---

# 四、再给你一个“进阶但非常值钱”的技巧（可选）

## 💡 使用“关系规则”而不是“文字解释”

在 Prompt 中加入：

```text
【风险匹配规则】
- 当 product_risk_level_R > client_risk_level_C → 风险不匹配
- 当 product_risk_level_R = client_risk_level_C → 风险临界
- 当 product_risk_level_R < client_risk_level_C → 风险可接受
```

模型**极擅长执行这种“半逻辑规则”**，
远胜于“请谨慎判断是否合适”。

---

# 五、一句话总结（工程视角）

> **C / R 不混用，靠的不是“模型理解”，而是“提示词工程的三重约束”：**
> **字段名定语义 → System Prompt 定规则 → 输出格式做校验。**
>
> 你现在这个设计，已经是**投顾级、可系统化上线的风险口径方案**。

---

如果你愿意，下一步我可以直接帮你做两件更“系统级”的事之一：

1️⃣ 把 **C1–C5 × R1–R5 的风险适配矩阵**做成 Prompt 内置规则
2️⃣ 设计一套 **“违规风险输出 → 自动回退重答”的 Prompt Guard**

这两步一上，你这套体系就完全是**生产级智能投顾风控内核**了。
